--CAU1--
--tao bang va khoa chinh, khoa ngoai
CREATE TABLE BTKHDL1.USER_NEW(
U_ID VARCHAR2(3),
USERNAME VARCHAR2(30),
PASS VARCHAR2(30),
REGDAY DATE,
NATIONALITY NVARCHAR2(50),

CONSTRAINT PK_USER_NEW PRIMARY KEY (U_ID) );

CREATE TABLE BTKHDL1.CHANNEL(
CHANNELID VARCHAR2(4),
CNAME NVARCHAR2(30),
SUBSCRIBES NUMBER,
OWN_ER VARCHAR2(3) ,
CREATED DATE,

CONSTRAINT PK_CHANNEL PRIMARY KEY (CHANNELID) ,
CONSTRAINT FK_CHANNEL_USER FOREIGN KEY (OWN_ER) REFERENCES USER_NEW(U_ID)
);

CREATE TABLE BTKHDL1.VIDEO(
VIDEOID VARCHAR2(10),
TITLE NVARCHAR2(200),
DURATION_ NUMBER,
AGE NUMBER ,

CONSTRAINT PK_VIDEO PRIMARY KEY (VIDEOID));

CREATE TABLE BTKHDL1.SHARE_(
VIDEOID VARCHAR2(10),
CHANNELID VARCHAR2(4),

CONSTRAINT PK_SHARE_CHANNEL FOREIGN KEY (CHANNELID) REFERENCES CHANNEL(CHANNELID),
CONSTRAINT FK_SHARE_VIDEO FOREIGN KEY (VIDEOID) REFERENCES VIDEO(VIDEOID)
);

--CAU2--

INSERT INTO USER_NEW VALUES ('001', 'faptv' ,'123456abc', TO_DATE('01/01/2014','dd/mm/yyyy'),'Viet Nam');
INSERT INTO USER_NEW VALUES ('002', 'kemxoitv','@147869iii',TO_DATE('05/06/2015','dd/mm/yyyy'),'Campuchia');
INSERT INTO USER_NEW VALUES ('003','openshare','qwertyuiop',TO_DATE('12/05/2009','dd/mm/yyyy'),'Viet Nam');

SELECT * FROM USER_NEW;

INSERT INTO CHANNEL VALUES ('C120' ,'FAP TV', 2343 ,'001',TO_DATE('02/01/2014','dd/mm/yyyy'));
INSERT INTO CHANNEL VALUES ('C905','Kem xoi TV', 1032 ,'002', TO_DATE('09/07/2015','dd/mm/yyyy'));
INSERT INTO CHANNEL VALUES ('C357', 'OpenShare Cafe', 5064 ,'003', TO_DATE('10/12/2010','dd/mm/yyyy'));

SELECT * FROM CHANNEL;


INSERT INTO VIDEO VALUES ('V100229', 'FAPtv Com Nguoi Tap 41 - ?ot Nhap', 469, 18);
INSERT INTO VIDEO VALUES ('V211002', 'Kem xoi: Tap 31 - May Kool tinh yeu cua anh', 312, 16);
INSERT INTO VIDEO VALUES ('V400002','Noi tinh yeu ket thuc - Hoang Tuan', 378, 0);


SELECT * FROM VIDEO;

INSERT INTO SHARE_ VALUES ('V100229', 'C905');
INSERT INTO SHARE_ VALUES ('V211002','C120');
INSERT INTO SHARE_ VALUES ('V400002','C357');

SELECT * FROM SHARE_;

--CAU3--
--RBTV: REGDAY DEFAULT IS TODAY
--TRIGGER

--CAU4--
--RBTV: CREATED >= REGDAY
--TRIGGER--

--CAU5--
--Tim tat ca video co AGE >= 16

SELECT * 
FROM  VIDEO
WHERE AGE >=16;


--CAU6--
--CHANNEL co SUBSCRIBES lon nhat--

SELECT *
FROM CHANNEL C
WHERE C.SUBSCRIBES >= ALL (SELECT C1.SUBSCRIBES
                            FROM CHANNEL C1                           
                            );
                            
--SELECT *
--FROM CHANNEL C
--ORDER BY SUBSCRIBES DESC
--FETCH FIRST 1 ROW ONLY;

--CAU7--
--Voi moi video co AGE = 18 => count(CHANNELID) FROM SHARE

SELECT COUNT(DISTINCT(S.CHANNELID))AS SO_KENH_CHIA_SE
FROM SHARE_ S
WHERE S.VIDEOID  IN (
    SELECT VIDEOID
    FROM VIDEO
    WHERE AGE=18);

SELECT COUNT(DISTINCT(S.CHANNELID)) AS SO_KENH_CHIA_SE
FROM SHARE_ S INNER JOIN VIDEO V ON S.VIDEOID=V.VIDEOID
WHERE AGE=18;


--CAU8--
--Tim video chia se tat ca cac kenh--

--Them du lieu de test--
INSERT INTO SHARE_ VALUES ('V211002', 'C120');
INSERT INTO SHARE_ VALUES ('V211002', 'C357');

SELECT * FROM SHARE_;

SELECT *
FROM VIDEO V
WHERE NOT EXISTS (
    SELECT *
    FROM CHANNEL C
    WHERE NOT EXISTS (
        SELECT * 
        FROM SHARE_ S
        WHERE C.CHANNELID =S.CHANNELID AND
                S.VIDEOID=V.VIDEOID));
        
